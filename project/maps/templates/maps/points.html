 {% load datetime_filter %}

var map;
$(document).ready(function () {
    prettyPrint();

    map = new GMaps({
        div: '#map',
        zoom: 12,
        lat: {{last_point.latitude|safe}},
        lng: {{last_point.longitude|safe}},
    });

    {% for item in tracks %}
        var points = [{% for point in item.points.all %}[{{ point.latitude|safe }}, {{ point.longitude|safe }}], {% endfor %}]
        var _last = points.length - 1;
        map.drawPolyline({path: points, strokeColor: "{% cycle 'Blue' 'Green' %}", strokeOpacity: 0.6, strokeWeight: 3 });
        map.addMarker({
            lat: points[_last][0],
            lng: points[_last][1],
            title: '',
            infoWindow: {
                content: `
                <table border="0">
                    <tr><td>Diena:</td><td>{{ item.date|date:'Y-m-d' }}</td></tr>
                    <tr><td>Atstumas:</td><td>{{ item.stats.total_km|floatformat:2 }} km</td></tr>
                    <tr><td>Laikas:</td><td>{{ item.stats.total_time_seconds|format_datetime }}</td></tr>
                    <tr><td>Vidutis greitis:</td><td>{{ item.stats.avg_speed|floatformat:2 }} km/h</td></tr>
                </table>
                `
            }
        });
    {% endfor %}
});
